<!DOCTYPE html>
<html lang="en" dir="ltr">
<head><script src="/flux-shared-platform/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=flux-shared-platform/livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  Examples
  #

Real-world examples of using the Flux Shared Platform components.

  Complete Cluster Setup
  #


  Basic Production Cluster
  #

Here&rsquo;s a complete example of setting up a production Kubernetes cluster with essential components:
# 1. Add the shared platform source
apiVersion: source.toolkit.fluxcd.io/v1
kind: GitRepository
metadata:
  name: flux-shared-platform
  namespace: flux-system
spec:
  interval: 10m
  ref:
    branch: main
  url: https://github.com/rossigee/flux-shared-platform

---
# 2. Deploy helm repositories first
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: shared-helm-repos
  namespace: flux-system
spec:
  interval: 30m
  path: ./helm-repos
  sourceRef:
    kind: GitRepository
    name: flux-shared-platform
  prune: true

---
# 3. Certificate management
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: cert-manager
  namespace: flux-system
spec:
  interval: 30m
  path: ./infrastructure/cert-manager
  sourceRef:
    kind: GitRepository
    name: flux-shared-platform
  dependsOn:
    - name: shared-helm-repos
  targetNamespace: cert-manager

---
# 4. Secrets management
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: external-secrets
  namespace: flux-system
spec:
  interval: 30m
  path: ./infrastructure/external-secrets
  sourceRef:
    kind: GitRepository
    name: flux-shared-platform
  dependsOn:
    - name: shared-helm-repos
  targetNamespace: external-secrets

---
# 5. Monitoring stack
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: prometheus-operator
  namespace: flux-system
spec:
  interval: 30m
  path: ./infrastructure/prometheus-operator
  sourceRef:
    kind: GitRepository
    name: flux-shared-platform
  dependsOn:
    - name: shared-helm-repos
  targetNamespace: monitoring

---
# 6. Policy enforcement
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: kyverno
  namespace: flux-system
spec:
  interval: 30m
  path: ./infrastructure/kyverno
  sourceRef:
    kind: GitRepository
    name: flux-shared-platform
  dependsOn:
    - name: shared-helm-repos
  targetNamespace: kyverno

  Environment-Specific Customizations
  #


  Development Environment
  #

# Development cluster with relaxed security for faster iteration
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: argo-workflows-dev
  namespace: flux-system
spec:
  interval: 10m  # Faster sync for development
  path: ./infrastructure/argo-workflows
  sourceRef:
    kind: GitRepository
    name: flux-shared-platform
  patches:
    - patch: |
        - op: replace
          path: /spec/values/controller/workflowNamespaces
          value: [&#34;default&#34;, &#34;development&#34;, &#34;testing&#34;]
        - op: replace
          path: /spec/values/server/secure
          value: false  # Disable HTTPS for local development
      target:
        kind: HelmRelease
        name: argo-workflows

  Production Environment
  #

# Production cluster with enhanced security and monitoring
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: argo-workflows-prod
  namespace: flux-system
spec:
  interval: 30m  # Slower sync for stability
  path: ./infrastructure/argo-workflows
  sourceRef:
    kind: GitRepository
    name: flux-shared-platform
  patches:
    - patch: |
        - op: replace
          path: /spec/values/controller/workflowNamespaces
          value: [&#34;production&#34;]
        - op: replace
          path: /spec/values/server/secure
          value: true
        - op: add
          path: /spec/values/controller/resources
          value:
            requests:
              cpu: 500m
              memory: 1Gi
            limits:
              cpu: 1000m
              memory: 2Gi
      target:
        kind: HelmRelease
        name: argo-workflows

  Multi-Cluster Deployments
  #


  Shared Services Cluster
  #

# Cluster dedicated to shared services (monitoring, secrets management)
---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: shared-monitoring
  namespace: flux-system
spec:
  path: ./infrastructure/prometheus-operator
  sourceRef:
    kind: GitRepository
    name: flux-shared-platform
  patches:
    - patch: |
        - op: replace
          path: /spec/values/prometheus/prometheusSpec/retention
          value: &#34;90d&#34;  # Longer retention for central monitoring
        - op: replace
          path: /spec/values/prometheus/prometheusSpec/storage/volumeClaimTemplate/spec/resources/requests/storage
          value: &#34;500Gi&#34;
      target:
        kind: HelmRelease
        name: prometheus-operator

  Application Clusters
  #

# Application clusters with minimal monitoring (metrics forwarded to shared cluster)
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: lightweight-monitoring
  namespace: flux-system
spec:
  path: ./infrastructure/prometheus-operator
  sourceRef:
    kind: GitRepository
    name: flux-shared-platform
  patches:
    - patch: |
        - op: replace
          path: /spec/values/prometheus/prometheusSpec/retention
          value: &#34;7d&#34;  # Short retention, forward to central
        - op: add
          path: /spec/values/prometheus/prometheusSpec/remoteWrite
          value:
            - url: https://shared-monitoring.example.com/api/v1/write
      target:
        kind: HelmRelease
        name: prometheus-operator

  Security Configurations
  #


  High Security Environment
  #

# Enhanced security configuration with policy enforcement
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: security-policies
  namespace: flux-system
spec:
  path: ./infrastructure/kyverno-policies
  sourceRef:
    kind: GitRepository
    name: flux-shared-platform
  patches:
    - patch: |
        - op: replace
          path: /spec/validationFailureAction
          value: enforce  # Block non-compliant resources
      target:
        kind: ClusterPolicy
        name: disallow-privileged-containers

  Network Security
  #

# Cilium with enhanced network policies
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: cilium-secure
  namespace: flux-system
spec:
  path: ./infrastructure/cilium
  sourceRef:
    kind: GitRepository
    name: flux-shared-platform
  patches:
    - patch: |
        - op: replace
          path: /spec/values/hubble/enabled
          value: true
        - op: replace
          path: /spec/values/hubble/relay/enabled
          value: true
        - op: replace
          path: /spec/values/hubble/ui/enabled
          value: true
      target:
        kind: HelmRelease
        name: cilium

  Integration Patterns
  #


  GitOps with External Secrets
  #

# External secrets integrated with HashiCorp Vault
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: vault-backend
  namespace: external-secrets
spec:
  provider:
    vault:
      server: &#34;https://vault.example.com&#34;
      path: &#34;secret&#34;
      version: &#34;v2&#34;
      auth:
        kubernetes:
          mountPath: &#34;kubernetes&#34;
          role: &#34;external-secrets&#34;

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: database-credentials
  namespace: production
spec:
  refreshInterval: 15s
  secretStoreRef:
    name: vault-backend
    kind: SecretStore
  target:
    name: database-credentials
    creationPolicy: Owner
  data:
  - secretKey: username
    remoteRef:
      key: database/production
      property: username
  - secretKey: password
    remoteRef:
      key: database/production
      property: password

  Monitoring Integration
  #

# Custom monitoring for your applications
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: my-app-metrics
  namespace: monitoring
spec:
  selector:
    matchLabels:
      app: my-application
  endpoints:
  - port: metrics
    interval: 30s
    path: /metrics

---
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: my-app-alerts
  namespace: monitoring
spec:
  groups:
  - name: my-app.rules
    rules:
    - alert: MyAppDown
      expr: up{job=&#34;my-application&#34;} == 0
      for: 5m
      annotations:
        summary: &#34;My application is down&#34;

  Cloud Provider Specific Examples
  #

The examples/ directory in the repository contains detailed examples for:">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/flux-shared-platform/docs/examples/">
  <meta property="og:site_name" content="Flux Shared Platform">
  <meta property="og:title" content="Examples">
  <meta property="og:description" content="Examples # Real-world examples of using the Flux Shared Platform components.
Complete Cluster Setup # Basic Production Cluster # Hereâ€™s a complete example of setting up a production Kubernetes cluster with essential components:
# 1. Add the shared platform source apiVersion: source.toolkit.fluxcd.io/v1 kind: GitRepository metadata: name: flux-shared-platform namespace: flux-system spec: interval: 10m ref: branch: main url: https://github.com/rossigee/flux-shared-platform --- # 2. Deploy helm repositories first apiVersion: kustomize.toolkit.fluxcd.io/v1 kind: Kustomization metadata: name: shared-helm-repos namespace: flux-system spec: interval: 30m path: ./helm-repos sourceRef: kind: GitRepository name: flux-shared-platform prune: true --- # 3. Certificate management apiVersion: kustomize.toolkit.fluxcd.io/v1 kind: Kustomization metadata: name: cert-manager namespace: flux-system spec: interval: 30m path: ./infrastructure/cert-manager sourceRef: kind: GitRepository name: flux-shared-platform dependsOn: - name: shared-helm-repos targetNamespace: cert-manager --- # 4. Secrets management apiVersion: kustomize.toolkit.fluxcd.io/v1 kind: Kustomization metadata: name: external-secrets namespace: flux-system spec: interval: 30m path: ./infrastructure/external-secrets sourceRef: kind: GitRepository name: flux-shared-platform dependsOn: - name: shared-helm-repos targetNamespace: external-secrets --- # 5. Monitoring stack apiVersion: kustomize.toolkit.fluxcd.io/v1 kind: Kustomization metadata: name: prometheus-operator namespace: flux-system spec: interval: 30m path: ./infrastructure/prometheus-operator sourceRef: kind: GitRepository name: flux-shared-platform dependsOn: - name: shared-helm-repos targetNamespace: monitoring --- # 6. Policy enforcement apiVersion: kustomize.toolkit.fluxcd.io/v1 kind: Kustomization metadata: name: kyverno namespace: flux-system spec: interval: 30m path: ./infrastructure/kyverno sourceRef: kind: GitRepository name: flux-shared-platform dependsOn: - name: shared-helm-repos targetNamespace: kyverno Environment-Specific Customizations # Development Environment # # Development cluster with relaxed security for faster iteration apiVersion: kustomize.toolkit.fluxcd.io/v1 kind: Kustomization metadata: name: argo-workflows-dev namespace: flux-system spec: interval: 10m # Faster sync for development path: ./infrastructure/argo-workflows sourceRef: kind: GitRepository name: flux-shared-platform patches: - patch: | - op: replace path: /spec/values/controller/workflowNamespaces value: [&#34;default&#34;, &#34;development&#34;, &#34;testing&#34;] - op: replace path: /spec/values/server/secure value: false # Disable HTTPS for local development target: kind: HelmRelease name: argo-workflows Production Environment # # Production cluster with enhanced security and monitoring apiVersion: kustomize.toolkit.fluxcd.io/v1 kind: Kustomization metadata: name: argo-workflows-prod namespace: flux-system spec: interval: 30m # Slower sync for stability path: ./infrastructure/argo-workflows sourceRef: kind: GitRepository name: flux-shared-platform patches: - patch: | - op: replace path: /spec/values/controller/workflowNamespaces value: [&#34;production&#34;] - op: replace path: /spec/values/server/secure value: true - op: add path: /spec/values/controller/resources value: requests: cpu: 500m memory: 1Gi limits: cpu: 1000m memory: 2Gi target: kind: HelmRelease name: argo-workflows Multi-Cluster Deployments # Shared Services Cluster # # Cluster dedicated to shared services (monitoring, secrets management) --- apiVersion: kustomize.toolkit.fluxcd.io/v1 kind: Kustomization metadata: name: shared-monitoring namespace: flux-system spec: path: ./infrastructure/prometheus-operator sourceRef: kind: GitRepository name: flux-shared-platform patches: - patch: | - op: replace path: /spec/values/prometheus/prometheusSpec/retention value: &#34;90d&#34; # Longer retention for central monitoring - op: replace path: /spec/values/prometheus/prometheusSpec/storage/volumeClaimTemplate/spec/resources/requests/storage value: &#34;500Gi&#34; target: kind: HelmRelease name: prometheus-operator Application Clusters # # Application clusters with minimal monitoring (metrics forwarded to shared cluster) apiVersion: kustomize.toolkit.fluxcd.io/v1 kind: Kustomization metadata: name: lightweight-monitoring namespace: flux-system spec: path: ./infrastructure/prometheus-operator sourceRef: kind: GitRepository name: flux-shared-platform patches: - patch: | - op: replace path: /spec/values/prometheus/prometheusSpec/retention value: &#34;7d&#34; # Short retention, forward to central - op: add path: /spec/values/prometheus/prometheusSpec/remoteWrite value: - url: https://shared-monitoring.example.com/api/v1/write target: kind: HelmRelease name: prometheus-operator Security Configurations # High Security Environment # # Enhanced security configuration with policy enforcement apiVersion: kustomize.toolkit.fluxcd.io/v1 kind: Kustomization metadata: name: security-policies namespace: flux-system spec: path: ./infrastructure/kyverno-policies sourceRef: kind: GitRepository name: flux-shared-platform patches: - patch: | - op: replace path: /spec/validationFailureAction value: enforce # Block non-compliant resources target: kind: ClusterPolicy name: disallow-privileged-containers Network Security # # Cilium with enhanced network policies apiVersion: kustomize.toolkit.fluxcd.io/v1 kind: Kustomization metadata: name: cilium-secure namespace: flux-system spec: path: ./infrastructure/cilium sourceRef: kind: GitRepository name: flux-shared-platform patches: - patch: | - op: replace path: /spec/values/hubble/enabled value: true - op: replace path: /spec/values/hubble/relay/enabled value: true - op: replace path: /spec/values/hubble/ui/enabled value: true target: kind: HelmRelease name: cilium Integration Patterns # GitOps with External Secrets # # External secrets integrated with HashiCorp Vault apiVersion: external-secrets.io/v1beta1 kind: SecretStore metadata: name: vault-backend namespace: external-secrets spec: provider: vault: server: &#34;https://vault.example.com&#34; path: &#34;secret&#34; version: &#34;v2&#34; auth: kubernetes: mountPath: &#34;kubernetes&#34; role: &#34;external-secrets&#34; --- apiVersion: external-secrets.io/v1beta1 kind: ExternalSecret metadata: name: database-credentials namespace: production spec: refreshInterval: 15s secretStoreRef: name: vault-backend kind: SecretStore target: name: database-credentials creationPolicy: Owner data: - secretKey: username remoteRef: key: database/production property: username - secretKey: password remoteRef: key: database/production property: password Monitoring Integration # # Custom monitoring for your applications apiVersion: monitoring.coreos.com/v1 kind: ServiceMonitor metadata: name: my-app-metrics namespace: monitoring spec: selector: matchLabels: app: my-application endpoints: - port: metrics interval: 30s path: /metrics --- apiVersion: monitoring.coreos.com/v1 kind: PrometheusRule metadata: name: my-app-alerts namespace: monitoring spec: groups: - name: my-app.rules rules: - alert: MyAppDown expr: up{job=&#34;my-application&#34;} == 0 for: 5m annotations: summary: &#34;My application is down&#34; Cloud Provider Specific Examples # The examples/ directory in the repository contains detailed examples for:">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
<title>Examples | Flux Shared Platform</title>
<link rel="icon" href="/flux-shared-platform/favicon.png" >
<link rel="manifest" href="/flux-shared-platform/manifest.json">
<link rel="canonical" href="http://localhost:1313/flux-shared-platform/docs/examples/">
<link rel="stylesheet" href="/flux-shared-platform/book.min.1739c62a7cbee733ac758c7b68066973946c839c3b7ff4b290373f86320d7b4b.css" integrity="sha256-FznGKny&#43;5zOsdYx7aAZpc5Rsg5w7f/SykDc/hjINe0s=" crossorigin="anonymous">
  <script defer src="/flux-shared-platform/fuse.min.js"></script>
  <script defer src="/flux-shared-platform/en.search.min.dee01ffe2057255046edcf4fc13302c22a06f6dc92aaa9f4bcf277b18b72dad0.js" integrity="sha256-3uAf/iBXJVBG7c9PwTMCwioG9tySqqn0vPJ3sYty2tA=" crossorigin="anonymous"></script>

  <script defer src="/flux-shared-platform/sw.min.91b5e938b9ec7ff17c26a2323df805583c32cc8550131f7c3cd048807adb112f.js" integrity="sha256-kbXpOLnsf/F8JqIyPfgFWDwyzIVQEx98PNBIgHrbES8=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/flux-shared-platform/"><span>Flux Shared Platform</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>















  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/flux-shared-platform/docs/quick-start/" class="">Quick Start</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/flux-shared-platform/docs/usage/" class="">Usage Guide</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/flux-shared-platform/docs/migration/" class="">Migration Guide</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/flux-shared-platform/docs/testing/" class="">Testing Guide</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/flux-shared-platform/docs/contributing/" class="">Contributing Guide</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/flux-shared-platform/docs/components/" class="">Component Reference</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/flux-shared-platform/docs/examples/" class="active">Examples</a>
  

        </li>
      
    
  </ul>










  
<ul>
  
  <li>
    <a href="https://github.com/rossigee/flux-shared-platform"  target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/flux-shared-platform/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Examples</h3>

  <label for="toc-control">
    
    <img src="/flux-shared-platform/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#examples">Examples</a>
      <ul>
        <li><a href="#complete-cluster-setup">Complete Cluster Setup</a>
          <ul>
            <li><a href="#basic-production-cluster">Basic Production Cluster</a></li>
          </ul>
        </li>
        <li><a href="#environment-specific-customizations">Environment-Specific Customizations</a>
          <ul>
            <li><a href="#development-environment">Development Environment</a></li>
            <li><a href="#production-environment">Production Environment</a></li>
          </ul>
        </li>
        <li><a href="#multi-cluster-deployments">Multi-Cluster Deployments</a>
          <ul>
            <li><a href="#shared-services-cluster">Shared Services Cluster</a></li>
            <li><a href="#application-clusters">Application Clusters</a></li>
          </ul>
        </li>
        <li><a href="#security-configurations">Security Configurations</a>
          <ul>
            <li><a href="#high-security-environment">High Security Environment</a></li>
            <li><a href="#network-security">Network Security</a></li>
          </ul>
        </li>
        <li><a href="#integration-patterns">Integration Patterns</a>
          <ul>
            <li><a href="#gitops-with-external-secrets">GitOps with External Secrets</a></li>
            <li><a href="#monitoring-integration">Monitoring Integration</a></li>
          </ul>
        </li>
        <li><a href="#cloud-provider-specific-examples">Cloud Provider Specific Examples</a></li>
        <li><a href="#testing-examples">Testing Examples</a></li>
        <li><a href="#more-examples">More Examples</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="examples">
  Examples
  <a class="anchor" href="#examples">#</a>
</h1>
<p>Real-world examples of using the Flux Shared Platform components.</p>
<h2 id="complete-cluster-setup">
  Complete Cluster Setup
  <a class="anchor" href="#complete-cluster-setup">#</a>
</h2>
<h3 id="basic-production-cluster">
  Basic Production Cluster
  <a class="anchor" href="#basic-production-cluster">#</a>
</h3>
<p>Here&rsquo;s a complete example of setting up a production Kubernetes cluster with essential components:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># 1. Add the shared platform source</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">source.toolkit.fluxcd.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">GitRepository</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">flux-shared-platform</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">flux-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">interval</span>: <span style="color:#ae81ff">10m</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ref</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">branch</span>: <span style="color:#ae81ff">main</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">url</span>: <span style="color:#ae81ff">https://github.com/rossigee/flux-shared-platform</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. Deploy helm repositories first</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kustomize.toolkit.fluxcd.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Kustomization</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">shared-helm-repos</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">flux-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">interval</span>: <span style="color:#ae81ff">30m</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./helm-repos</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sourceRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">GitRepository</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">flux-shared-platform</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">prune</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. Certificate management</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kustomize.toolkit.fluxcd.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Kustomization</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cert-manager</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">flux-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">interval</span>: <span style="color:#ae81ff">30m</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./infrastructure/cert-manager</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sourceRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">GitRepository</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">flux-shared-platform</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">dependsOn</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">shared-helm-repos</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">targetNamespace</span>: <span style="color:#ae81ff">cert-manager</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 4. Secrets management</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kustomize.toolkit.fluxcd.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Kustomization</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">external-secrets</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">flux-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">interval</span>: <span style="color:#ae81ff">30m</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./infrastructure/external-secrets</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sourceRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">GitRepository</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">flux-shared-platform</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">dependsOn</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">shared-helm-repos</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">targetNamespace</span>: <span style="color:#ae81ff">external-secrets</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 5. Monitoring stack</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kustomize.toolkit.fluxcd.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Kustomization</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">prometheus-operator</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">flux-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">interval</span>: <span style="color:#ae81ff">30m</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./infrastructure/prometheus-operator</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sourceRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">GitRepository</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">flux-shared-platform</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">dependsOn</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">shared-helm-repos</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">targetNamespace</span>: <span style="color:#ae81ff">monitoring</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 6. Policy enforcement</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kustomize.toolkit.fluxcd.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Kustomization</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">kyverno</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">flux-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">interval</span>: <span style="color:#ae81ff">30m</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./infrastructure/kyverno</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sourceRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">GitRepository</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">flux-shared-platform</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">dependsOn</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">shared-helm-repos</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">targetNamespace</span>: <span style="color:#ae81ff">kyverno</span>
</span></span></code></pre></div><h2 id="environment-specific-customizations">
  Environment-Specific Customizations
  <a class="anchor" href="#environment-specific-customizations">#</a>
</h2>
<h3 id="development-environment">
  Development Environment
  <a class="anchor" href="#development-environment">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Development cluster with relaxed security for faster iteration</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kustomize.toolkit.fluxcd.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Kustomization</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">argo-workflows-dev</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">flux-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">interval</span>: <span style="color:#ae81ff">10m </span> <span style="color:#75715e"># Faster sync for development</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./infrastructure/argo-workflows</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sourceRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">GitRepository</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">flux-shared-platform</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">patches</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">patch</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - op: replace
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          path: /spec/values/controller/workflowNamespaces
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          value: [&#34;default&#34;, &#34;development&#34;, &#34;testing&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - op: replace
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          path: /spec/values/server/secure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          value: false  # Disable HTTPS for local development</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">target</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">HelmRelease</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">argo-workflows</span>
</span></span></code></pre></div><h3 id="production-environment">
  Production Environment
  <a class="anchor" href="#production-environment">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Production cluster with enhanced security and monitoring</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kustomize.toolkit.fluxcd.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Kustomization</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">argo-workflows-prod</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">flux-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">interval</span>: <span style="color:#ae81ff">30m </span> <span style="color:#75715e"># Slower sync for stability</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./infrastructure/argo-workflows</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sourceRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">GitRepository</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">flux-shared-platform</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">patches</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">patch</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - op: replace
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          path: /spec/values/controller/workflowNamespaces
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          value: [&#34;production&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - op: replace
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          path: /spec/values/server/secure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          value: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - op: add
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          path: /spec/values/controller/resources
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          value:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            requests:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              cpu: 500m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              memory: 1Gi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            limits:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              cpu: 1000m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              memory: 2Gi</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">target</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">HelmRelease</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">argo-workflows</span>
</span></span></code></pre></div><h2 id="multi-cluster-deployments">
  Multi-Cluster Deployments
  <a class="anchor" href="#multi-cluster-deployments">#</a>
</h2>
<h3 id="shared-services-cluster">
  Shared Services Cluster
  <a class="anchor" href="#shared-services-cluster">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Cluster dedicated to shared services (monitoring, secrets management)</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kustomize.toolkit.fluxcd.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Kustomization</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">shared-monitoring</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">flux-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./infrastructure/prometheus-operator</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sourceRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">GitRepository</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">flux-shared-platform</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">patches</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">patch</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - op: replace
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          path: /spec/values/prometheus/prometheusSpec/retention
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          value: &#34;90d&#34;  # Longer retention for central monitoring
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - op: replace
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          path: /spec/values/prometheus/prometheusSpec/storage/volumeClaimTemplate/spec/resources/requests/storage
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          value: &#34;500Gi&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">target</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">HelmRelease</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">prometheus-operator</span>
</span></span></code></pre></div><h3 id="application-clusters">
  Application Clusters
  <a class="anchor" href="#application-clusters">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Application clusters with minimal monitoring (metrics forwarded to shared cluster)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kustomize.toolkit.fluxcd.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Kustomization</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">lightweight-monitoring</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">flux-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./infrastructure/prometheus-operator</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sourceRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">GitRepository</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">flux-shared-platform</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">patches</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">patch</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - op: replace
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          path: /spec/values/prometheus/prometheusSpec/retention
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          value: &#34;7d&#34;  # Short retention, forward to central
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - op: add
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          path: /spec/values/prometheus/prometheusSpec/remoteWrite
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          value:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            - url: https://shared-monitoring.example.com/api/v1/write</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">target</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">HelmRelease</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">prometheus-operator</span>
</span></span></code></pre></div><h2 id="security-configurations">
  Security Configurations
  <a class="anchor" href="#security-configurations">#</a>
</h2>
<h3 id="high-security-environment">
  High Security Environment
  <a class="anchor" href="#high-security-environment">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Enhanced security configuration with policy enforcement</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kustomize.toolkit.fluxcd.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Kustomization</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">security-policies</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">flux-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./infrastructure/kyverno-policies</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sourceRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">GitRepository</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">flux-shared-platform</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">patches</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">patch</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - op: replace
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          path: /spec/validationFailureAction
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          value: enforce  # Block non-compliant resources</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">target</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterPolicy</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">disallow-privileged-containers</span>
</span></span></code></pre></div><h3 id="network-security">
  Network Security
  <a class="anchor" href="#network-security">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Cilium with enhanced network policies</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kustomize.toolkit.fluxcd.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Kustomization</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cilium-secure</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">flux-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./infrastructure/cilium</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sourceRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">GitRepository</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">flux-shared-platform</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">patches</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">patch</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - op: replace
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          path: /spec/values/hubble/enabled
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          value: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - op: replace
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          path: /spec/values/hubble/relay/enabled
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          value: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - op: replace
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          path: /spec/values/hubble/ui/enabled
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          value: true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">target</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">HelmRelease</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cilium</span>
</span></span></code></pre></div><h2 id="integration-patterns">
  Integration Patterns
  <a class="anchor" href="#integration-patterns">#</a>
</h2>
<h3 id="gitops-with-external-secrets">
  GitOps with External Secrets
  <a class="anchor" href="#gitops-with-external-secrets">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># External secrets integrated with HashiCorp Vault</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">external-secrets.io/v1beta1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">SecretStore</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">vault-backend</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">external-secrets</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">provider</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">vault</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">server</span>: <span style="color:#e6db74">&#34;https://vault.example.com&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">path</span>: <span style="color:#e6db74">&#34;secret&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">version</span>: <span style="color:#e6db74">&#34;v2&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">auth</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kubernetes</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#e6db74">&#34;kubernetes&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">role</span>: <span style="color:#e6db74">&#34;external-secrets&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">external-secrets.io/v1beta1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ExternalSecret</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">database-credentials</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">production</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">refreshInterval</span>: <span style="color:#ae81ff">15s</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">secretStoreRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">vault-backend</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">SecretStore</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">target</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">database-credentials</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">creationPolicy</span>: <span style="color:#ae81ff">Owner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">secretKey</span>: <span style="color:#ae81ff">username</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">remoteRef</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">key</span>: <span style="color:#ae81ff">database/production</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">property</span>: <span style="color:#ae81ff">username</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">secretKey</span>: <span style="color:#ae81ff">password</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">remoteRef</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">key</span>: <span style="color:#ae81ff">database/production</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">property</span>: <span style="color:#ae81ff">password</span>
</span></span></code></pre></div><h3 id="monitoring-integration">
  Monitoring Integration
  <a class="anchor" href="#monitoring-integration">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Custom monitoring for your applications</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">monitoring.coreos.com/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceMonitor</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">my-app-metrics</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">monitoring</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">my-application</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">endpoints</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">metrics</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">interval</span>: <span style="color:#ae81ff">30s</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/metrics</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">monitoring.coreos.com/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PrometheusRule</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">my-app-alerts</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">monitoring</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">groups</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">my-app.rules</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">alert</span>: <span style="color:#ae81ff">MyAppDown</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">expr</span>: <span style="color:#ae81ff">up{job=&#34;my-application&#34;} == 0</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">for</span>: <span style="color:#ae81ff">5m</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">summary</span>: <span style="color:#e6db74">&#34;My application is down&#34;</span>
</span></span></code></pre></div><h2 id="cloud-provider-specific-examples">
  Cloud Provider Specific Examples
  <a class="anchor" href="#cloud-provider-specific-examples">#</a>
</h2>
<p>The <code>examples/</code> directory in the repository contains detailed examples for:</p>
<ul>
<li><strong>AWS</strong>: EKS-specific configurations with ALB ingress, EBS CSI, and IAM roles</li>
<li><strong>Azure</strong>: AKS-specific configurations with Azure DNS and Key Vault integration</li>
<li><strong>GCP</strong>: GKE-specific configurations with Cloud DNS and Secret Manager</li>
<li><strong>On-premises</strong>: Bare metal Kubernetes with MetalLB and local storage</li>
</ul>
<h2 id="testing-examples">
  Testing Examples
  <a class="anchor" href="#testing-examples">#</a>
</h2>
<p>For testing and validation examples, see the 
  <a href="/flux-shared-platform/docs/testing/">Testing Guide</a> which includes:</p>
<ul>
<li>Health check manifests</li>
<li>Load testing configurations</li>
<li>Rollback procedures</li>
<li>Monitoring validation</li>
</ul>
<h2 id="more-examples">
  More Examples
  <a class="anchor" href="#more-examples">#</a>
</h2>
<p>Browse the complete examples directory in the repository:</p>
<ul>
<li>
  <a href="https://github.com/rossigee/flux-shared-platform/tree/main/examples">Repository Examples</a></li>
</ul>
<p>Each example includes:</p>
<ul>
<li>Complete configuration files</li>
<li>Deployment instructions</li>
<li>Customization options</li>
<li>Testing procedures</li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>





  
  
  
  <div class="flex flex-wrap justify-between">
    <span>
    
      <a href="/flux-shared-platform/docs/components/" class="flex align-center book-icon">
        <img src="/flux-shared-platform/svg/backward.svg" class="book-icon" alt="Previous" title="Component Reference" />
        <span>Component Reference</span>
      </a>
    
    </span>
    <span>
    
    </span>
  </div>
  




  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#examples">Examples</a>
      <ul>
        <li><a href="#complete-cluster-setup">Complete Cluster Setup</a>
          <ul>
            <li><a href="#basic-production-cluster">Basic Production Cluster</a></li>
          </ul>
        </li>
        <li><a href="#environment-specific-customizations">Environment-Specific Customizations</a>
          <ul>
            <li><a href="#development-environment">Development Environment</a></li>
            <li><a href="#production-environment">Production Environment</a></li>
          </ul>
        </li>
        <li><a href="#multi-cluster-deployments">Multi-Cluster Deployments</a>
          <ul>
            <li><a href="#shared-services-cluster">Shared Services Cluster</a></li>
            <li><a href="#application-clusters">Application Clusters</a></li>
          </ul>
        </li>
        <li><a href="#security-configurations">Security Configurations</a>
          <ul>
            <li><a href="#high-security-environment">High Security Environment</a></li>
            <li><a href="#network-security">Network Security</a></li>
          </ul>
        </li>
        <li><a href="#integration-patterns">Integration Patterns</a>
          <ul>
            <li><a href="#gitops-with-external-secrets">GitOps with External Secrets</a></li>
            <li><a href="#monitoring-integration">Monitoring Integration</a></li>
          </ul>
        </li>
        <li><a href="#cloud-provider-specific-examples">Cloud Provider Specific Examples</a></li>
        <li><a href="#testing-examples">Testing Examples</a></li>
        <li><a href="#more-examples">More Examples</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












